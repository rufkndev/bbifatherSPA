# üöÄ –ì–∞–π–¥ –ø–æ –¥–µ–ø–ª–æ—é BBI Father –Ω–∞ —Å–µ—Ä–≤–µ—Ä

–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è BBI Father –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Supabase, Nginx –∏ PM2.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
2. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-supabase)
3. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞)
4. [–î–µ–ø–ª–æ–π backend](#–¥–µ–ø–ª–æ–π-backend)
5. [–î–µ–ø–ª–æ–π frontend](#–¥–µ–ø–ª–æ–π-frontend)
6. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-nginx)
7. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-ssl)
8. [Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è](#telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
9. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–µ—Ä–≤–µ—Ä
- Ubuntu 20.04+ –∏–ª–∏ CentOS 8+
- –ú–∏–Ω–∏–º—É–º 1GB RAM, 1 CPU
- –î–æ—Å—Ç—É–ø –ø–æ SSH
- –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `bbifather.ru`)

### –õ–æ–∫–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞
- Node.js 18+
- Git
- SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É

## üóÉÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Supabase

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [supabase.com](https://supabase.com)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (2-3 –º–∏–Ω—É—Ç—ã)
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ:
   - Project URL
   - Anon public key
   - Service role key (–¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π)

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ó–∞–π–¥–∏—Ç–µ –≤ SQL Editor –≤ Supabase Dashboard –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
CREATE TABLE IF NOT EXISTS students (
    id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    group_name TEXT,
    telegram TEXT,
    email TEXT,
    phone TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–µ–¥–º–µ—Ç–æ–≤
CREATE TABLE IF NOT EXISTS subjects (
    id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL DEFAULT 0.0,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE IF NOT EXISTS orders (
    id BIGSERIAL PRIMARY KEY,
    student_id BIGINT NOT NULL REFERENCES students(id),
    subject_id BIGINT NOT NULL REFERENCES subjects(id),
    title TEXT NOT NULL,
    description TEXT NOT NULL,
    input_data TEXT,
    variant_info TEXT,
    deadline DATE NOT NULL,
    status TEXT DEFAULT 'new' CHECK (status IN ('new', 'waiting_payment', 'paid', 'in_progress', 'completed', 'needs_revision')),
    is_paid BOOLEAN DEFAULT false,
    files JSONB,
    selected_works JSONB,
    is_full_course BOOLEAN DEFAULT false,
    actual_price DECIMAL(10,2) DEFAULT 0.0,
    revision_comment TEXT,
    revision_grade TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX IF NOT EXISTS idx_orders_student_id ON orders(student_id);
CREATE INDEX IF NOT EXISTS idx_orders_subject_id ON orders(subject_id);
CREATE INDEX IF NOT EXISTS idx_orders_status ON orders(status);
CREATE INDEX IF NOT EXISTS idx_orders_created_at ON orders(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_students_telegram ON students(telegram);

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at –≤ —Ç–∞–±–ª–∏—Ü–µ orders
CREATE TRIGGER update_orders_updated_at 
    BEFORE UPDATE ON orders 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤ (–¥–æ–±–∞–≤–ª—è–µ–º 'queued' –∏ 'under_review')
ALTER TABLE orders DROP CONSTRAINT IF EXISTS orders_status_check;
ALTER TABLE orders ADD CONSTRAINT orders_status_check 
    CHECK (status IN ('new', 'waiting_payment', 'paid', 'in_progress', 'completed', 'needs_revision', 'queued', 'under_review'));

-- –ï—Å–ª–∏ —É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Åa –Ω–µ –±—ã–ª–æ –∏–º–µ–Ω–∏ –∏ DROP –≤—ã—à–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:
-- –ù–∞–π–¥–∏—Ç–µ –∏–º—è CHECK-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —É–¥–∞–ª–∏—Ç–µ –µ–≥–æ
-- (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ conname, –∑–∞—Ç–µ–º –ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ DROP CONSTRAINT)
SELECT conname 
FROM pg_constraint c 
JOIN pg_class t ON c.conrelid = t.oid 
WHERE t.relname = 'orders' AND c.contype = 'c';
-- –ü—Ä–∏–º–µ—Ä:
-- ALTER TABLE public.orders DROP CONSTRAINT orders_status_check_legacy;
-- –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ, –∫–∞–∫ –≤—ã—à–µ

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
INSERT INTO subjects (name, description, price) VALUES
    ('–õ–µ—Ç–Ω—è—è –ø—Ä–∞–∫—Ç–∏–∫–∞', '–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏', 2500.0),
    ('–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã', '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–º –º–µ—Ç–æ–¥–∞–º', 2000.0),
    ('–ü–£–ü', '–ü—Ä–∞–∫—Ç–∏–∫–∏, –ò–ö–†, —Ä–µ—Ñ–µ—Ä–∞—Ç—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è', 2200.0),
    ('–¶–∏—Ñ—Ä–æ–≤–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞', '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –ø–æ —Ü–∏—Ñ—Ä–æ–≤–æ–π —ç–∫–æ–Ω–æ–º–∏–∫–µ', 1800.0),
    ('–ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤', '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã –ø–æ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—é –ë–ü', 2000.0),
    ('–î—Ä—É–≥–æ–π –ø—Ä–µ–¥–º–µ—Ç', '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ –¥—Ä—É–≥–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É', 1500.0)
ON CONFLICT DO NOTHING;
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RLS (Row Level Security)

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞:

```sql
-- –í–∫–ª—é—á–∞–µ–º RLS –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
ALTER TABLE students ENABLE ROW LEVEL SECURITY;
ALTER TABLE subjects ENABLE ROW LEVEL SECURITY;
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (–º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å)
CREATE POLICY "Allow all for service role" ON students FOR ALL USING (auth.role() = 'service_role');
CREATE POLICY "Allow all for service role" ON subjects FOR ALL USING (auth.role() = 'service_role');
CREATE POLICY "Allow all for service role" ON orders FOR ALL USING (auth.role() = 'service_role');

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤)
CREATE POLICY "Allow read subjects" ON subjects FOR SELECT USING (is_active = true);
CREATE POLICY "Allow insert orders" ON orders FOR INSERT WITH CHECK (true);
CREATE POLICY "Allow read own orders" ON orders FOR SELECT USING (true);
CREATE POLICY "Allow update own orders" ON orders FOR UPDATE USING (true);
CREATE POLICY "Allow insert students" ON students FOR INSERT WITH CHECK (true);
```

## üñ•Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh root@your-server-ip
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
# Ubuntu/Debian
apt update && apt upgrade -y

# CentOS/RHEL
yum update -y
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

```bash
# Ubuntu/Debian
apt install -y curl wget git nginx certbot python3-certbot-nginx

# CentOS/RHEL
yum install -y curl wget git nginx certbot python3-certbot-nginx
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js –∏ npm

```bash
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º NodeSource —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
apt install -y nodejs

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
node --version
npm --version
```

### 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∏ pip

```bash
apt install -y python3 python3-pip python3-venv
```

### 6. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2 –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

```bash
npm install -g pm2
```

## üîô –î–µ–ø–ª–æ–π Backend

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
useradd -m -s /bin/bash bbifather
usermod -aG sudo bbifather
```

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è bbifather
su - bbifather

# –ö–ª–æ–Ω–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç
git clone https://github.com/rufkndev/bbifatherSPA.git
cd bbifatherSPA

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ backend
cd backend
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python3 -m venv venv
source venv/bin/activate
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª
nano .env
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `.env`:

```env
# Supabase –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
SUPABASE_URL=https://yvtobwpaxdgvvobhaymq.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl2dG9id3BheGRndnZvYmhheW1xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMDg5MTksImV4cCI6MjA2OTg4NDkxOX0.yrfE7RBIoMfrhRWD2ptU9pyerTvxwXHW_y6V3FzNi80

# Telegram Bot –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TELEGRAM_BOT_TOKEN=7582178055:AAFcTdIt3g1LiJ-6-W0QDR1p1MPm9LkSFCY
TELEGRAM_CHAT_ID=814032949
# –û—Ç–¥–µ–ª—å–Ω—ã–π —á–∞—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É ERP (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
TELEGRAM_ERP_CHAT_ID=814032949

# Frontend URLs –¥–ª—è CORS
FRONTEND_URLS=https://bbifather.ru,https://www.bbifather.ru

# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
ENVIRONMENT=production
```

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ backend

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
python main.py
```

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ `http://your-server-ip:8000` - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "Student Orders API is running".

### 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PM2 –¥–ª—è backend

```bash
# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'bbifather-backend',
    script: 'start.sh',
    cwd: '/home/bbifather/bbifatherSPA/backend',
    interpreter: '/bin/bash',
    env: {
      ENVIRONMENT: 'production'
    },
    error_file: '/home/bbifather/logs/backend-error.log',
    out_file: '/home/bbifather/logs/backend-out.log',
    log_file: '/home/bbifather/logs/backend.log',
    time: true,
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G'
  }]
};
EOF

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤
mkdir -p /home/bbifather/logs

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PM2
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

## üé® –î–µ–ø–ª–æ–π Frontend

### 1. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é frontend

```bash
cd /home/bbifather/bbifatherSPA/frontend
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API URL

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `src/api.ts`:

```typescript
// –ó–∞–º–µ–Ω–∏—Ç–µ localhost –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
const API_BASE_URL = 'https://bbifather.ru/api';
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–±–æ—Ä–∫–∞

```bash
npm install
npm run build
```
dMa87H_?+yU2bP
### 4. –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ build –≤ nginx –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

```bash
sudo mkdir -p /var/www/bbifather
sudo cp -r build/* /var/www/bbifather/
sudo chown -R www-data:www-data /var/www/bbifather
```

## üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx

```bash
sudo nano /etc/nginx/sites-available/bbifather
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```nginx
# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å www –Ω–∞ –±–µ–∑ www
server {
    listen 80;
    listen [::]:80;
    server_name www.bbifather.ru;
    return 301 http://bbifather.ru$request_uri;
}

# –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
server {
    listen 80;
    listen [::]:80;
    server_name bbifather.ru;

    # –õ–æ–≥–∏
    access_log /var/log/nginx/bbifather_access.log;
    error_log /var/log/nginx/bbifather_error.log;

    # –ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
    root /var/www/bbifather;
    index index.html index.htm;

    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
    client_max_body_size 10M;

    # Gzip —Å–∂–∞—Ç–∏–µ
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json;

    # API –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ backend
    location /api/ {
        proxy_pass http://127.0.0.1:8000/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 86400;
    }

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ React Router (SPA)
    location / {
        try_files $uri $uri/ /index.html;
    }

    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }

    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;

    # –°–∫—Ä—ã—Ç–∏–µ –≤–µ—Ä—Å–∏–∏ Nginx
    server_tokens off;
}
```

### 2. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞–µ–º —Å–∏–º–ª–∏–Ω–∫
sudo ln -s /etc/nginx/sites-available/bbifather /etc/nginx/sites-enabled/

# –£–¥–∞–ª—è–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo rm /etc/nginx/sites-enabled/default

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º Nginx
sudo systemctl restart nginx
sudo systemctl enable nginx
```

## üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —á–µ—Ä–µ–∑ Let's Encrypt

```bash
sudo certbot --nginx -d bbifather.ru -d www.bbifather.ru
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```bash
# –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤ cron
sudo crontab -e

# –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É:
0 12 * * * /usr/bin/certbot renew --quiet
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx —Å SSL

Certbot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

```bash
sudo nano /etc/nginx/sites-available/bbifather
```

## üì± Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞

1. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –í—ã–±–µ—Ä–∏—Ç–µ –∏–º—è –∏ username –¥–ª—è –±–æ—Ç–∞
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ Chat ID

```bash
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
curl https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
```

–ù–∞–π–¥–∏—Ç–µ `chat.id` –≤ –æ—Ç–≤–µ—Ç–µ.

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
nano /home/bbifather/bbifatherSPA/backend/.env
```

–î–æ–±–∞–≤—å—Ç–µ:

```env
TELEGRAM_BOT_TOKEN=your-bot-token
TELEGRAM_CHAT_ID=your-chat-id
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend

```bash
pm2 restart bbifather-backend
```

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–°–¥–µ–ª–∞–π—Ç–µ POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/test-notification`:

```bash
curl -X POST https://bbifather.ru/api/test-notification
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ PM2

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
pm2 status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 logs bbifather-backend

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 restart bbifather-backend

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 monit
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Nginx

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status nginx

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –¥–æ—Å—Ç—É–ø–∞
sudo tail -f /var/log/nginx/bbifather_access.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫
sudo tail -f /var/log/nginx/bbifather_error.log
```

### 3. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
#!/bin/bash
# backup.sh

BACKUP_DIR="/home/bbifather/backups"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# –ë—ç–∫–∞–ø —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
tar -czf $BACKUP_DIR/app_$DATE.tar.gz /home/bbifather/bbifatherSPA

# –ë—ç–∫–∞–ø Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp /etc/nginx/sites-available/bbifather $BACKUP_DIR/nginx_$DATE.conf

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete
find $BACKUP_DIR -name "*.conf" -mtime +30 -delete

echo "Backup completed: $DATE"
```

–î–æ–±–∞–≤—å—Ç–µ –≤ cron:

```bash
crontab -e
# –î–æ–±–∞–≤—å—Ç–µ:
0 2 * * * /home/bbifather/backup.sh
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
#!/bin/bash
# update.sh

cd /home/bbifather/bbifatherSPA

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 stop bbifather-backend

# –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
git pull origin main

# –û–±–Ω–æ–≤–ª—è–µ–º backend
cd backend
source venv/bin/activate
pip install -r requirements.txt

# –û–±–Ω–æ–≤–ª—è–µ–º frontend
cd ../frontend
npm install
npm run build
sudo cp -r build/* /var/www/bbifather/

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 start bbifather-backend

echo "Update completed!"
```

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs bbifather-backend

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cat /home/bbifather/bbifatherSPA/backend/.env

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase
curl -H "apikey: YOUR_SUPABASE_KEY" https://your-project.supabase.co/rest/v1/subjects
```

### –ü—Ä–æ–±–ª–µ–º–∞: Nginx 502 Bad Gateway

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å backend
pm2 status

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/bbifather_error.log

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 8000
netstat -tlnp | grep :8000
```

### –ü—Ä–æ–±–ª–µ–º–∞: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot certificates

# –û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot renew --dry-run
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. ‚úÖ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `https://bbifather.ru`
2. ‚úÖ API –æ—Ç–≤–µ—á–∞–µ—Ç: `https://bbifather.ru/api/subjects`
3. ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç (–∑–µ–ª–µ–Ω—ã–π –∑–∞–º–æ–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
4. ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
5. ‚úÖ PM2 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω: `pm2 status`

## üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!

–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ BBI Father —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä–µ!

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ —Å—Ç–µ–∫–∞
sudo systemctl restart nginx
pm2 restart all

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ª–æ–≥–æ–≤
pm2 logs --lines 100

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot renew

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
htop
df -h
```

python backend/main.py & python bot.py & wait
pkill -f "python bot.py" && pkill -f "python backend/main.py"

# –û–±–Ω–æ–≤–ª—è–µ–º frontend
cd ../frontend
npm run build
sudo cp -r build/* /var/www/bbifather/
sudo systemctl restart nginx